import{j as e}from"./ui-DXEsCjYO.js";import{r as o}from"./vendor-B6OAZll8.js";import{u as B}from"./audio-B1K76-a3.js";import{c as p,f as S,s as A,b as D,B as E}from"./index-CeHcYKT_.js";import{e as z,l as U,h as G,m as K,n as O,o as X,p as H,q as J,r as Q,s as Y,t as Z}from"./icons-KOPessbp.js";import{c as ee,b as _}from"./state-BMzes8HB.js";import{u as se}from"./useConnection-NXU-bj3v.js";import{t as C}from"./utils-E4Pq5uL6.js";import"./sdk-9Bd1H_oq.js";const te=(s=100)=>{const t=[];for(let a=0;a<s;a++){const r=Math.sin(a/8)*.4+.5,i=Math.random()*.3;t.push(Math.max(.1,Math.min(1,r+i)))}return t};function ae({isUser:s=!1,isRecording:t=!1,audioUrl:a,durationMs:r}){const i=o.useRef(null),x=o.useRef(null),[g,f]=o.useState(!!a);return o.useEffect(()=>{if(i.current){if(a&&!t){const u=B.create({container:i.current,waveColor:s?"rgba(0, 0, 0, 0.5)":"rgba(255, 255, 255, 0.5)",progressColor:s?"#000000":"#ffffff",height:60,barWidth:2,barGap:1,barRadius:2,cursorWidth:0,normalize:!0,url:a});return u.on("ready",()=>{f(!1)}),u.on("error",m=>{console.error("WaveSurfer error:",m),f(!1)}),x.current=u,()=>{u.destroy()}}else if(!t){const u=te(100),m=B.create({container:i.current,waveColor:s?"rgba(0, 0, 0, 0.6)":"rgba(255, 255, 255, 0.6)",progressColor:s?"#000000":"#ffffff",height:60,barWidth:2,barGap:1,barRadius:2,cursorWidth:0,normalize:!0});return m.load("",[u],r?r/1e3:5),x.current=m,f(!1),()=>{m.destroy()}}}},[a,t,s,r]),t?e.jsx("div",{className:"flex items-center justify-center gap-0.5 h-16 my-2 px-4 rounded-lg bg-opacity-10 w-full max-w-full overflow-hidden",children:Array.from({length:50}).map((m,h)=>e.jsx("div",{className:`w-1 rounded-full ${s?"bg-black/80":"bg-white/80"} animate-pulse`,style:{height:`${Math.random()*40+20}px`,animationDelay:`${h*30}ms`,animationDuration:`${800+Math.random()*400}ms`}},h))}):e.jsxs("div",{className:"my-2 px-2 min-w-[300px]",children:[g&&e.jsx("div",{className:"flex items-center justify-center h-16",children:e.jsx("span",{className:"text-xs text-gray-500",children:"Loading waveform..."})}),e.jsx("div",{ref:i,className:`${g?"hidden":""}`})]})}function w(s){return function(a){const{message:r,showTime:i=!0,...x}=a,f=r.role==="assistant"&&r.kind==="Playback"?"100%":"60%";return e.jsxs("div",{className:"flex flex-col",style:{maxWidth:f},children:[e.jsx(s,{...x,message:r,showTime:i}),e.jsx("span",{className:"timestamp",style:{alignSelf:r.role==="user"?"flex-end":"flex-start"},children:new Date(r.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})}}function ne({message:s,showTime:t,className:a}){return e.jsx("div",{className:p("SttStreamRequestMessage",a),children:e.jsxs("div",{className:"voice-message-header",children:[e.jsx("div",{className:"voice-message-info",children:e.jsxs("div",{className:"voice-message-icon-text",children:[e.jsx(z,{className:"voice-message-icon text-black"}),e.jsx("span",{className:"voice-message-label text-black",children:"STT Stream"}),t&&e.jsx("span",{className:"voice-message-time text-black",children:S(s.durationMs)})]})}),e.jsx("div",{className:"waveform-container",children:e.jsx(ae,{isUser:!0,isRecording:s.isRecording||!1,durationMs:s.durationMs})}),s.status==="error"&&s.error&&e.jsx("div",{className:"voice-message-error",children:e.jsxs("span",{className:"voice-message-error-text text-red-600",children:["Error: ",s.error]})})]})})}const re=w(ne);function ce({message:s,showTime:t,className:a}){return e.jsx("div",{className:p("SttFileRequestMessage",a),children:e.jsxs("div",{className:"file-message-indicator",children:[s.status==="processing"?e.jsx(U,{className:"file-message-icon animate-spin text-black"}):e.jsx(G,{className:"file-message-icon text-black"}),e.jsx("span",{className:"file-message-text text-black",children:s.status==="processing"?"Processing file...":e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"voice-message-label text-black",children:"STT File"})," ",e.jsx("span",{className:"voice-message-time text-black",children:s.fileName||"upload"}),t&&e.jsx("span",{className:"voice-message-time text-black",children:S(s.durationMs)})]})})]})})}const ie=w(ce);function oe({message:s,showTime:t,className:a}){return e.jsxs("div",{className:p("TtsRequestMessage",a,"tts-request-message"),children:[e.jsx("div",{className:"voice-message-header",children:e.jsx("div",{className:"voice-message-info",children:e.jsxs("div",{className:"voice-message-icon-text",children:[e.jsx(K,{className:"voice-tts-icon text-black"}),e.jsx("span",{className:"voice-message-label text-black",children:"TTS"}),e.jsx(O,{className:"voice-message-icon text-black"}),e.jsx("span",{className:"voice-message-time text-black",children:s.voice||"tara"}),t&&e.jsx("span",{className:"voice-message-time text-black",children:S(s.durationMs)})]})})}),s.content&&e.jsx("p",{className:"message-content-request",children:s.content})]})}const le=w(oe);function de({message:s,showTime:t,className:a}){return e.jsxs("div",{className:p("TranscriptResponseMessage",a),children:[e.jsx("div",{className:"transcript-message-header",children:e.jsx("div",{className:"transcript-message-info",children:e.jsxs("div",{className:"transcript-message-icon-text",children:[e.jsx(X,{className:"transcript-message-icon"}),e.jsx("span",{className:"transcript-message-label text-black",children:"Transcription"}),t&&e.jsx("span",{className:"voice-message-time text-black",children:S(s.durationMs)})]})})}),s.content&&e.jsx("p",{className:"message-content-response",children:s.content})]})}const ue=w(de);function me(s){const t=s.environment;return{apiKey:s[t].connection.apiKey,baseUrl:s[t].connection.baseUrl,authBaseUrl:s[t].connection.authBaseUrl,workflowId:s[t].connection.workflowId,environment:t,stt:s[t].stt,tts:s[t].tts}}function fe(){const s=ee(A),{getClient:t,isConnected:a,sessionId:r}=se(),[i,x]=o.useState(!1),g=o.useCallback(async(f,u)=>{try{x(!0);const m=await t(),h=me(s),N=await m.tts.synthesize({text:f,voice:u||h.tts.voice,language:h.tts.language}),b=[],y=N.getReader();try{for(;;){const{done:c,value:j}=await y.read();if(c)break;b.push(j)}}finally{y.releaseLock()}const k=b.reduce((c,j)=>c+j.length,0),v=new Uint8Array(k);let T=0;for(const c of b)v.set(c,T),T+=c.length;return new Blob([v],{type:"audio/mpeg"})}finally{x(!1)}},[t,s]);return{isGenerating:i,isConnected:a,sessionId:r,generateTTS:g}}function xe(s){const t=s.environment;return{apiKey:s[t].connection.apiKey,baseUrl:s[t].connection.baseUrl,authBaseUrl:s[t].connection.authBaseUrl,workflowId:s[t].connection.workflowId,environment:t,stt:s[t].stt,tts:s[t].tts}}function he({messageId:s,text:t,className:a=""}){const[r,i]=_(D),[x]=_(A),g=xe(x),[f,u]=o.useState(null),[m,h]=o.useState(!1),[N,b]=o.useState(0),[y,k]=o.useState(0),[v,T]=o.useState(1),c=o.useRef(null),j=o.useRef(null),{generateTTS:q,isGenerating:I}=fe(),M=r.playingMessageId===s;o.useEffect(()=>()=>{c.current&&(c.current.pause(),c.current=null)},[]),o.useEffect(()=>{const n=c.current;if(!n)return;const l=()=>k(n.currentTime),d=()=>b(n.duration);return n.addEventListener("timeupdate",l),n.addEventListener("loadedmetadata",d),()=>{n.removeEventListener("timeupdate",l),n.removeEventListener("loadedmetadata",d)}},[M]);const W=async()=>{if(M){c.current&&c.current.pause(),i(n=>({...n,playingMessageId:void 0}));return}r.playingMessageId&&c.current&&c.current.pause();try{if(h(!0),!f){if(!g.apiKey){C.error("Please configure your API key first");return}const d=await q(t);u(d)}const n=URL.createObjectURL(f||new Blob),l=new Audio(n);c.current=l,l.volume=v,l.addEventListener("ended",()=>{i(d=>({...d,playingMessageId:void 0})),k(0),URL.revokeObjectURL(n)}),l.addEventListener("error",d=>{console.error("Audio playback error:",d),C.error("Audio playback failed"),i(R=>({...R,playingMessageId:void 0})),URL.revokeObjectURL(n)}),i(d=>({...d,playingMessageId:s})),await l.play()}catch(n){console.error("TTS Error:",n),C.error("Text-to-speech failed")}finally{h(!1)}},V=n=>{if(!c.current||!j.current)return;const l=j.current.getBoundingClientRect(),d=n.clientX-l.left,R=l.width,P=d/R*N;c.current.currentTime=P,k(P)},$=n=>{const l=parseFloat(n.target.value);T(l),c.current&&(c.current.volume=l)},L=n=>{if(isNaN(n))return"0:00";const l=Math.floor(n/60),d=Math.floor(n%60);return`${l}:${d.toString().padStart(2,"0")}`},F=N>0?y/N*100:0;return e.jsx("div",{className:p("TTSPlaybackWidget",a),children:e.jsxs("div",{className:"tts-playback-controls",children:[e.jsxs("div",{className:"tts-top-row",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:W,disabled:I||m,className:"tts-play-button",children:I||m?e.jsx(U,{className:"h-4 w-4 animate-spin"}):M?e.jsx(H,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"})}),e.jsxs("div",{className:"tts-progress-container",children:[e.jsx("div",{className:"tts-progress-wrapper",children:e.jsx("div",{className:"tts-progress-track",ref:j,onClick:V,children:e.jsx("div",{className:"tts-progress-fill",style:{width:`${F}%`}})})}),e.jsxs("div",{className:"tts-time-display",children:[e.jsx("span",{className:"tts-current-time",children:L(y)}),e.jsx("span",{className:"tts-duration",children:L(N)})]})]})]}),e.jsxs("div",{className:"tts-volume-control",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>{const n=v>0?0:1;T(n),c.current&&(c.current.volume=n)},className:"tts-volume-button",children:v>0?e.jsx(Q,{className:"h-4 w-4"}):e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:v,onChange:$,className:"tts-volume-slider"})]})]})})}function pe({message:s,showTime:t,className:a}){return e.jsxs("div",{className:p("VoiceResponseMessage",a),children:[e.jsx("div",{className:"transcript-message-header",children:e.jsx("div",{className:"transcript-message-info",children:e.jsxs("div",{className:"transcript-message-icon-text",children:[e.jsx(Z,{className:"transcript-message-icon"}),e.jsx("span",{className:"transcript-message-label text-black",children:"TTS Playback"}),t&&s.durationMs&&e.jsx("span",{className:"voice-message-time",children:S(s.durationMs)})]})})}),e.jsx(he,{messageId:s.id,className:"tts-playback-widget-content",text:""})]})}const ge=w(pe);function ve({message:s,showTime:t=!0}){const a=s.role==="user",r=()=>{if(s.role==="user"){if(s.kind==="STT Stream")return e.jsx(re,{message:s,showTime:t});if(s.kind==="STT File")return e.jsx(ie,{message:s,showTime:t});if(s.kind==="TTS")return e.jsx(le,{message:s,showTime:t})}if(s.role==="assistant"){if(s.kind==="Transcription")return e.jsx(ue,{message:s,showTime:t});if(s.kind==="Playback")return e.jsx(ge,{message:s,showTime:t})}return e.jsxs("div",{className:"chat-message__unsupported",children:[e.jsxs("p",{className:"chat-message__unsupported-title",children:["Unsupported message type: ",s.kind," / ",s.role]}),s.content&&e.jsx("p",{className:"chat-message__unsupported-content",children:s.content})]})};return e.jsx("div",{className:p("ChatMessage","chat-message",a?"chat-message--user":"chat-message--assistant"),children:e.jsx("div",{className:`chat-message__content ${a?"chat-message__content--user":"chat-message__content--assistant"}`,children:r()})})}function je(){return e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-[#212529] rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-2xl",children:"AI"})}),e.jsx("h3",{className:"text-[#212529] text-xl font-semibold mb-2",children:"Aiola Api APP"}),e.jsx("p",{className:"text-[#6c757d] text-sm leading-relaxed",children:"Transcribe voice recordings or upload audio files. Use the microphone to record speech or upload files for transcription."})]})})}function Ie({messages:s}){const t=o.useRef(null),a=[...s].sort((r,i)=>i.createdAt-r.createdAt);return o.useEffect(()=>{t.current&&(t.current.scrollTop=0)},[s.length]),s.length===0?e.jsx(je,{}):e.jsx("div",{ref:t,className:p("ChatMessageList","chat-message-list"),children:a.map(r=>e.jsx(ve,{message:r,showTime:!0},r.id))})}export{Ie as ChatMessageList};
