import{j as n,k as q,a as M}from"./ui-c6rpaoQp.js";import{r as g}from"./vendor-B6OAZll8.js";import{c as O,a as S,u as W,S as R,b as D,d as K,e as B,f as P,B as Z}from"./index-DbGP0vH-.js";import{u as H}from"./useConnection-XzYsOZzo.js";import{t as u}from"./utils-E4Pq5uL6.js";import"./state-BMzes8HB.js";import"./icons-BcCThlEi.js";import"./sdk-9Bd1H_oq.js";const m=g.forwardRef(({className:s,type:i,...c},h)=>n.jsx("input",{type:i,className:O("Input",S("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s)),ref:h,...c}));m.displayName="Input";const Y=M("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=g.forwardRef(({className:s,...i},c)=>n.jsx(q,{ref:c,className:S(Y(),s),...i}));d.displayName=q.displayName;const G=g.forwardRef(({className:s,...i},c)=>n.jsx("textarea",{className:S("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:c,...i}));G.displayName="Textarea";const J=[{value:"en_US",label:"English (US)"},{value:"en_GB",label:"English (UK)"},{value:"es_ES",label:"Spanish (Spain)"},{value:"fr_FR",label:"French (France)"},{value:"de_DE",label:"German (Germany)"},{value:"it_IT",label:"Italian (Italy)"},{value:"pt_BR",label:"Portuguese (Brazil)"},{value:"ja_JP",label:"Japanese (Japan)"},{value:"ko_KR",label:"Korean (Korea)"},{value:"zh_CN",label:"Chinese (China)"}],V=[{value:"tara",label:"Tara"},{value:"zoe",label:"Zoe"},{value:"zac",label:"Zac"},{value:"dan",label:"Dan"},{value:"jess",label:"Jess"},{value:"leo",label:"Leo"},{value:"mia",label:"Mia"},{value:"julia",label:"Julia"},{value:"leah",label:"Leah"}];function C(s){const i=s.environment;return{apiKey:s[i].connection.apiKey,baseUrl:s[i].connection.baseUrl,authBaseUrl:s[i].connection.authBaseUrl,workflowId:s[i].connection.workflowId,stt:s[i].stt,tts:s[i].tts}}function Q(s,i,c){return{...s,environment:i,[i]:{connection:{...s[i].connection,...c.connection},stt:{...s[i].stt,...c.stt},tts:{...s[i].tts,...c.tts}}}}function le({open:s,onOpenChange:i}){const[c,h]=W(),[e,r]=g.useState(c),[k,I]=g.useState(!1),[E,_]=g.useState(!1),{createSession:$,isConnected:U}=H(),T=g.useRef(null),F=g.useCallback((o,t)=>{var L;const a=C(o),l=C(t),f=t.environment,v=o.environment!==t.environment,x=a.apiKey!==l.apiKey,b=a.stt.language!==l.stt.language,j=JSON.stringify(a.stt.keywords)!==JSON.stringify(l.stt.keywords),N=a.workflowId!==l.workflowId,w=a.stt.rememberFlowid!==l.stt.rememberFlowid,y=a.tts.voice!==l.tts.voice,A=JSON.stringify(a.stt.vad)!==JSON.stringify(l.stt.vad);return(v||x||b||j||N||w||y||A)&&console.log(`[checkSettingsChanged] Settings changed detected for ${f} environment:`,{environment:{changed:v,from:o.environment,to:f},apiKey:{changed:x,currentLength:((L=l.apiKey)==null?void 0:L.length)||0},stt:{languageChanged:b,keywordsChanged:j,rememberFlowidChanged:w,workflowIdChanged:N,vadConfigChanged:A},tts:{voiceChanged:y}}),x||v||b||j||N||w||y},[]),p=g.useCallback(o=>{const t=e.environment,l={...Q(e,t,C(e)),environment:o};console.log("ConfigDialog: Switching environment to",o),console.log("ConfigDialog: New temp settings:",l),r(l),_(!0)},[e]);g.useEffect(()=>{s&&(r(c),_(!1))},[s]),g.useEffect(()=>{s&&_(F(c,e))},[e,c,s,F]),g.useEffect(()=>{if(!s)return;const o=t=>{var v;const a=t.target,l=(v=T.current)==null?void 0:v.contains(a),f=a.closest(`
        [data-radix-select-viewport],
        [data-radix-popover-content],
        [data-radix-select-content],
        [data-radix-menu-content],
        [role="option"],
        [role="listbox"],
        [role="menu"],
        [role="combobox"],
        [data-state="open"],
        [data-radix-collection-item]
      `);!l&&!f&&i(!1)};return document.addEventListener("mousedown",o,!0),()=>{document.removeEventListener("mousedown",o,!0)}},[s,i]);const z=async()=>{const o=e.environment;if(!e[o].connection.apiKey.trim()){u.error("API Key is required");return}if(o==="custom"){if(!e.custom.connection.baseUrl.trim()){u.error("Base URL is required for custom environment");return}if(!e.custom.connection.authBaseUrl.trim()){u.error("Auth URL is required for custom environment");return}try{new URL(e.custom.connection.baseUrl)}catch{u.error("Base URL must be a valid URL");return}try{new URL(e.custom.connection.authBaseUrl)}catch{u.error("Auth URL must be a valid URL");return}}if(E&&U){const t={...e,[o]:{...e[o],stt:{...e[o].stt,rememberFlowid:e[o].stt.rememberFlowid}}};h(t),localStorage.setItem("aiola-settings",JSON.stringify(t)),u.success("Settings saved - Reloading page to apply changes"),i(!1),setTimeout(()=>{window.location.reload()},1e3);return}I(!0);try{await $(!0);const t={...e,[o]:{...e[o],stt:{...e[o].stt,rememberFlowid:e[o].stt.rememberFlowid}}};h(t),localStorage.setItem("aiola-settings",JSON.stringify(t)),u.success("Settings saved successfully - Connection verified"),i(!1)}catch(t){console.warn("Connection test failed, but saving settings anyway:",t);const a={...e,[o]:{...e[o],stt:{...e[o].stt,rememberFlowid:e[o].stt.rememberFlowid}}};h(a),localStorage.setItem("aiola-settings",JSON.stringify(a)),u.warning(`Settings saved but connection failed: ${t instanceof Error?t.message:"Unknown error"}`),i(!1)}finally{I(!1)}};return s?n.jsx("div",{className:O("ConfigDialog","config-dialog__container"),children:n.jsxs("div",{ref:T,className:"config-dialog__content",onClick:o=>{o.stopPropagation()},children:[n.jsxs("div",{className:"config-dialog__header",children:[n.jsxs("div",{className:"config-dialog__header-content",children:[n.jsx("h2",{className:"config-dialog__title",children:"Configuration"}),n.jsx("button",{onClick:()=>i(!1),className:"config-dialog__close-button","aria-label":"Close configuration",children:"Ã—"})]}),n.jsx("p",{className:"config-dialog__description",children:"Configure your Aiola API settings, speech-to-text, and text-to-speech preferences."})]}),n.jsxs("div",{className:"config-dialog__main",children:[n.jsxs("section",{className:"config-dialog__section",children:[n.jsxs("div",{className:"config-dialog__section-header",children:[n.jsx("h3",{className:"config-dialog__section-title",children:"Connection"}),n.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure your Aiola API connection and authentication"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(d,{htmlFor:"api-key",className:"config-dialog__label config-dialog__label--required",children:"API Key / Access Token"}),n.jsx(m,{id:"api-key",type:"password",value:e[e.environment].connection.apiKey,onChange:o=>{const t=o.target.value;console.log("[ConfigDialog] API key changed:",{hasValue:!!t,length:t.length,preview:t.substring(0,10)+(t.length>10?"...":"")});const a=e.environment,l={...e,[a]:{...e[a],connection:{...e[a].connection,apiKey:t}}};r(l);const f={...l,[a]:{...l[a],stt:{...l[a].stt,rememberFlowid:l[a].stt.rememberFlowid}}};localStorage.setItem("aiola-settings",JSON.stringify(f)),h(f)},placeholder:"Enter your Aiola API key",className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(d,{htmlFor:"workflowId",className:"config-dialog__label",children:"Workflow ID"}),n.jsx(m,{id:"workflowId",value:e[e.environment].connection.workflowId||"",onChange:o=>{const t=o.target.value;console.log("[ConfigDialog] Workflow ID changed:",{from:e[e.environment].connection.workflowId||"",to:t,hasValue:!!t});const a=e.environment;r({...e,[a]:{...e[a],connection:{...e[a].connection,workflowId:o.target.value}}})},placeholder:"Enter workflow ID for STT processing",className:"config-dialog__input"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Optional: SDK will use default workflow if empty"}),e.environment==="custom"&&n.jsx("p",{className:"config-dialog__helper-text",style:{marginTop:"0.5rem",fontStyle:"italic"},children:"Note: Default workflowId may not work with custom environments"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(d,{className:"config-dialog__label",children:"Environment"}),n.jsxs("div",{className:"config-dialog__toggle-container",children:[n.jsx("button",{type:"button",onClick:()=>p("prod"),className:`config-dialog__toggle-button ${e.environment==="prod"?"config-dialog__toggle-button--active":""}`,children:"Prod"}),n.jsx("button",{type:"button",onClick:()=>p("dev"),className:`config-dialog__toggle-button ${e.environment==="dev"?"config-dialog__toggle-button--active":""}`,children:"Dev"}),n.jsx("button",{type:"button",onClick:()=>p("custom"),className:`config-dialog__toggle-button ${e.environment==="custom"?"config-dialog__toggle-button--active":""}`,children:"Custom"})]}),n.jsx("p",{className:"config-dialog__helper-text",children:"Select the API environment: Production, Development, or Custom"})]}),e.environment==="custom"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(d,{htmlFor:"custom-base-url",className:"config-dialog__label config-dialog__label--required",children:"Base URL"}),n.jsx(m,{id:"custom-base-url",type:"url",value:e.custom.connection.baseUrl,onChange:o=>{const t=o.target.value;r({...e,custom:{...e.custom,connection:{...e.custom.connection,baseUrl:t}}})},placeholder:"https://your-api.example.com",className:"config-dialog__input"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Enter the base URL for your custom API environment"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(d,{htmlFor:"custom-auth-url",className:"config-dialog__label config-dialog__label--required",children:"Auth URL"}),n.jsx(m,{id:"custom-auth-url",type:"url",value:e.custom.connection.authBaseUrl,onChange:o=>{const t=o.target.value;r({...e,custom:{...e.custom,connection:{...e.custom.connection,authBaseUrl:t}}})},placeholder:"https://your-auth.example.com",className:"config-dialog__input"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Enter the authentication URL for your custom API environment"})]})]})]}),n.jsxs("section",{className:"config-dialog__section",children:[n.jsxs("div",{className:"config-dialog__section-header",children:[n.jsx("h3",{className:"config-dialog__section-title",children:"Speech-to-Text"}),n.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure speech recognition settings and language preferences"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(d,{htmlFor:"stt-language",className:"config-dialog__label config-dialog__label--required",children:"Language/Accent"}),n.jsxs(R,{value:e[e.environment].stt.language,onValueChange:o=>{var a;console.log("[ConfigDialog] STT language changed:",{from:e[e.environment].stt.language,to:o,languageLabel:(a=J.find(l=>l.value===o))==null?void 0:a.label});const t=e.environment;r({...e,[t]:{...e[t],stt:{...e[t].stt,language:o}}})},children:[n.jsx(D,{className:"config-dialog__select",children:n.jsx(K,{placeholder:"Select language"})}),n.jsx(B,{children:J.map(o=>n.jsx(P,{value:o.value,children:o.label},o.value))})]})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(d,{htmlFor:"keywords",className:"config-dialog__label",children:"Keywords"}),n.jsx(G,{id:"keywords",value:e[e.environment].stt.keywords.join(", "),onChange:o=>{const t=o.target.value.split(",").map(l=>l.trim()).filter(Boolean);console.log("[ConfigDialog] STT keywords changed:",{from:e[e.environment].stt.keywords,to:t,count:t.length});const a=e.environment;r({...e,[a]:{...e[a],stt:{...e[a].stt,keywords:t}}})},placeholder:"[word1, word2] or [{'A Yo La': 'aiola'}, {'bay tar': 'beitar'}]",rows:3,className:"config-dialog__textarea"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Comma-separated keywords to improve recognition accuracy"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(d,{className:"config-dialog__label",children:"VAD Config"}),n.jsxs("div",{className:"config-dialog__vad-config",children:[n.jsx("div",{className:"config-dialog__vad-toggle",children:n.jsxs("label",{className:"config-dialog__checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:typeof e[e.environment].stt.vad=="object",onChange:o=>{const t=e.environment;r({...e,[t]:{...e[t],stt:{...e[t].stt,vad:o.target.checked?{threshold:.5,min_speech_ms:250,min_silence_ms:500,max_segment_ms:3e4}:"default"}}})},className:"config-dialog__checkbox"}),n.jsx("span",{children:"Use custom VAD configuration"})]})}),typeof e[e.environment].stt.vad=="object"&&n.jsxs("div",{className:"config-dialog__vad-fields",children:[n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(d,{htmlFor:"vad-threshold",className:"config-dialog__vad-label",children:"Threshold (0.0 - 1.0)"}),n.jsx(m,{id:"vad-threshold",type:"number",min:"0",max:"1",step:"0.1",value:e[e.environment].stt.vad.threshold||.5,onChange:o=>{const t=e.environment,a=e[t].stt.vad;r({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...a,threshold:parseFloat(o.target.value)||.5}}}})},className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(d,{htmlFor:"vad-min-speech",className:"config-dialog__vad-label",children:"Min Speech (ms)"}),n.jsx(m,{id:"vad-min-speech",type:"number",min:"0",value:e[e.environment].stt.vad.min_speech_ms||250,onChange:o=>{const t=e.environment,a=e[t].stt.vad;r({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...a,min_speech_ms:parseInt(o.target.value)||250}}}})},className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(d,{htmlFor:"vad-min-silence",className:"config-dialog__vad-label",children:"Min Silence (ms)"}),n.jsx(m,{id:"vad-min-silence",type:"number",min:"0",value:e[e.environment].stt.vad.min_silence_ms||500,onChange:o=>{const t=e.environment,a=e[t].stt.vad;r({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...a,min_silence_ms:parseInt(o.target.value)||500}}}})},className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(d,{htmlFor:"vad-max-segment",className:"config-dialog__vad-label",children:"Max Segment (ms)"}),n.jsx(m,{id:"vad-max-segment",type:"number",min:"0",value:e[e.environment].stt.vad.max_segment_ms||3e4,onChange:o=>{const t=e.environment,a=e[t].stt.vad;r({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...a,max_segment_ms:parseInt(o.target.value)||3e4}}}})},className:"config-dialog__input"})]})]})]})]})]}),n.jsxs("section",{className:"config-dialog__section",children:[n.jsxs("div",{className:"config-dialog__section-header",children:[n.jsx("h3",{className:"config-dialog__section-title",children:"Text-to-Speech"}),n.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure voice synthesis settings and voice selection"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(d,{htmlFor:"tts-voice",className:"config-dialog__label",children:"Voice"}),n.jsxs(R,{value:e[e.environment].tts.voice,onValueChange:o=>{var a;console.log("[ConfigDialog] TTS voice changed:",{from:e[e.environment].tts.voice,to:o,voiceLabel:(a=V.find(l=>l.value===o))==null?void 0:a.label});const t=e.environment;r({...e,[t]:{...e[t],tts:{...e[t].tts,voice:o}}})},children:[n.jsx(D,{className:"config-dialog__select",children:n.jsx(K,{placeholder:"Select voice"})}),n.jsx(B,{children:V.map(o=>n.jsx(P,{value:o.value,children:o.label},o.value))})]})]}),n.jsx("div",{className:"config-dialog__info-box",children:n.jsx("p",{className:"config-dialog__info-text",children:"Language/Accent: Fixed to English (en) - non-editable"})})]})]}),n.jsx("div",{className:"config-dialog__footer",children:n.jsxs("div",{className:"config-dialog__button-container",children:[n.jsx("div",{className:"config_buttons",children:n.jsx(Z,{onClick:z,disabled:k,className:"config-dialog__button config-dialog__button--primary",children:k?"Connecting...":E&&U?"Reload":"Connect"})}),n.jsx("div",{className:"config-dialog__info-box",children:n.jsx("p",{className:"config-dialog__info-text",children:"All configuration settings are automatically cached and will be remembered for future sessions"})})]})})]})}):null}export{le as ConfigDialog};
