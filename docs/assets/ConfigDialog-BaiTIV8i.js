import{j as e,R as J,a as ne,b as oe,V as ae,T as z,I as se,P as ie,C as G,d as le,e as $,f as re,g as ce,h as O,i as W,L as q,k as Z}from"./ui-DXEsCjYO.js";import{r as c}from"./vendor-B6OAZll8.js";import{c as H,a as g,u as de,B as ge}from"./index-CdJ0LLsE.js";import{C as M,d as me,e as fe}from"./icons-Bi8i6cou.js";import{u as ue}from"./useConnection-h2CLINrd.js";import{t as p}from"./utils-E4Pq5uL6.js";import"./state-BMzes8HB.js";import"./sdk-9Bd1H_oq.js";const S=c.forwardRef(({className:o,type:a,...l},d)=>e.jsx("input",{type:a,className:H("Input",g("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",o)),ref:d,...l}));S.displayName="Input";const he=ne("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),m=c.forwardRef(({className:o,...a},l)=>e.jsx(J,{ref:l,className:g(he(),o),...a}));m.displayName=J.displayName;const Y=c.forwardRef(({className:o,...a},l)=>e.jsx("textarea",{className:g("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",o),ref:l,...a}));Y.displayName="Textarea";const P=oe,U=ae,C=c.forwardRef(({className:o,children:a,...l},d)=>e.jsxs(z,{ref:d,className:g("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",o),...l,children:[a,e.jsx(se,{asChild:!0,children:e.jsx(M,{className:"h-4 w-4 opacity-50"})})]}));C.displayName=z.displayName;const Q=c.forwardRef(({className:o,...a},l)=>e.jsx(O,{ref:l,className:g("flex cursor-default items-center justify-center py-1",o),...a,children:e.jsx(fe,{className:"h-4 w-4"})}));Q.displayName=O.displayName;const X=c.forwardRef(({className:o,...a},l)=>e.jsx(W,{ref:l,className:g("flex cursor-default items-center justify-center py-1",o),...a,children:e.jsx(M,{className:"h-4 w-4"})}));X.displayName=W.displayName;const k=c.forwardRef(({className:o,children:a,position:l="popper",...d},t)=>e.jsx(ie,{children:e.jsxs(G,{ref:t,className:g("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-white text-black shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",l==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",o),position:l,...d,children:[e.jsx(Q,{}),e.jsx(le,{className:g("p-1",l==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(X,{})]})}));k.displayName=G.displayName;const pe=c.forwardRef(({className:o,...a},l)=>e.jsx(q,{ref:l,className:g("py-1.5 pl-8 pr-2 text-sm font-semibold",o),...a}));pe.displayName=q.displayName;const I=c.forwardRef(({className:o,children:a,...l},d)=>e.jsxs($,{ref:d,className:g("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-black data-[disabled]:pointer-events-none data-[disabled]:opacity-50",o),...l,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(re,{children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsx(ce,{children:a})]}));I.displayName=$.displayName;const xe=c.forwardRef(({className:o,...a},l)=>e.jsx(Z,{ref:l,className:g("-mx-1 my-1 h-px bg-muted",o),...a}));xe.displayName=Z.displayName;const V=[{value:"en_US",label:"English (US)"},{value:"en_GB",label:"English (UK)"},{value:"es_ES",label:"Spanish (Spain)"},{value:"fr_FR",label:"French (France)"},{value:"de_DE",label:"German (Germany)"},{value:"it_IT",label:"Italian (Italy)"},{value:"pt_BR",label:"Portuguese (Brazil)"},{value:"ja_JP",label:"Japanese (Japan)"},{value:"ko_KR",label:"Korean (Korea)"},{value:"zh_CN",label:"Chinese (China)"}],B=[{value:"tara",label:"Tara"},{value:"zoe",label:"Zoe"},{value:"zac",label:"Zac"},{value:"dan",label:"Dan"},{value:"jess",label:"Jess"},{value:"leo",label:"Leo"},{value:"mia",label:"Mia"},{value:"julia",label:"Julia"},{value:"leah",label:"Leah"}];function y(o){const a=o.environment;return{apiKey:o[a].connection.apiKey,baseUrl:o[a].connection.baseUrl,authBaseUrl:o[a].connection.authBaseUrl,workflowId:o[a].connection.workflowId,stt:o[a].stt,tts:o[a].tts}}function ve(o,a,l){return{...o,environment:a,[a]:{connection:{...o[a].connection,...l.connection},stt:{...o[a].stt,...l.stt},tts:{...o[a].tts,...l.tts}}}}function ke({open:o,onOpenChange:a}){const[l,d]=de(),[t,f]=c.useState(l),[T,E]=c.useState(!1),[D,x]=c.useState(!1),{createSession:ee,isConnected:K}=ue(),R=c.useRef(null),F=c.useCallback((n,s)=>{var L;const i=y(n),r=y(s),u=s.environment,h=n.environment!==s.environment,v=i.apiKey!==r.apiKey,b=i.stt.language!==r.stt.language,_=JSON.stringify(i.stt.keywords)!==JSON.stringify(r.stt.keywords),w=i.workflowId!==r.workflowId,N=i.stt.rememberFlowid!==r.stt.rememberFlowid,j=i.tts.voice!==r.tts.voice;return(h||v||b||_||w||N||j)&&console.log(`[checkSettingsChanged] Settings changed detected for ${u} environment:`,{environment:{changed:h,from:n.environment,to:u},apiKey:{changed:v,currentLength:((L=r.apiKey)==null?void 0:L.length)||0},stt:{languageChanged:b,keywordsChanged:_,rememberFlowidChanged:N,workflowIdChanged:w},tts:{voiceChanged:j}}),v||h||b||_||w||N||j},[]),A=c.useCallback(n=>{const s=t.environment,r={...ve(t,s,y(t)),environment:n};console.log("ConfigDialog: Switching environment to",n),console.log("ConfigDialog: New temp settings:",r),f(r),x(!0)},[t]);c.useEffect(()=>{o&&(f(l),x(!1))},[o]),c.useEffect(()=>{o&&x(F(l,t))},[t,l,o,F]),c.useEffect(()=>{if(!o)return;const n=s=>{var h;const i=s.target,r=(h=R.current)==null?void 0:h.contains(i),u=i.closest(`
        [data-radix-select-viewport],
        [data-radix-popover-content],
        [data-radix-select-content],
        [data-radix-menu-content],
        [role="option"],
        [role="listbox"],
        [role="menu"],
        [role="combobox"],
        [data-state="open"],
        [data-radix-collection-item]
      `);!r&&!u&&a(!1)};return document.addEventListener("mousedown",n,!0),()=>{document.removeEventListener("mousedown",n,!0)}},[o,a]);const te=async()=>{const n=t.environment;if(!t[n].connection.apiKey.trim()){p.error("API Key is required");return}if(D&&K){const s={...t,[n]:{...t[n],stt:{...t[n].stt,rememberFlowid:t[n].stt.rememberFlowid}}};d(s),localStorage.setItem("aiola-settings",JSON.stringify(s)),p.success("Settings saved - Reloading page to apply changes"),a(!1),setTimeout(()=>{window.location.reload()},1e3);return}E(!0);try{await ee(!0);const s={...t,[n]:{...t[n],stt:{...t[n].stt,rememberFlowid:t[n].stt.rememberFlowid}}};d(s),localStorage.setItem("aiola-settings",JSON.stringify(s)),p.success("Settings saved successfully - Connection verified"),a(!1)}catch(s){console.warn("Connection test failed, but saving settings anyway:",s);const i={...t,[n]:{...t[n],stt:{...t[n].stt,rememberFlowid:t[n].stt.rememberFlowid}}};d(i),localStorage.setItem("aiola-settings",JSON.stringify(i)),p.warning(`Settings saved but connection failed: ${s instanceof Error?s.message:"Unknown error"}`),a(!1)}finally{E(!1)}};return o?e.jsx("div",{className:H("ConfigDialog","config-dialog__container"),children:e.jsxs("div",{ref:R,className:"config-dialog__content",onClick:n=>{n.stopPropagation()},children:[e.jsxs("div",{className:"config-dialog__header",children:[e.jsxs("div",{className:"config-dialog__header-content",children:[e.jsx("h2",{className:"config-dialog__title",children:"Configuration"}),e.jsx("button",{onClick:()=>a(!1),className:"config-dialog__close-button","aria-label":"Close configuration",children:"Ã—"})]}),e.jsx("p",{className:"config-dialog__description",children:"Configure your Aiola API settings, speech-to-text, and text-to-speech preferences."})]}),e.jsxs("div",{className:"config-dialog__main",children:[e.jsxs("section",{className:"config-dialog__section",children:[e.jsxs("div",{className:"config-dialog__section-header",children:[e.jsx("h3",{className:"config-dialog__section-title",children:"Connection"}),e.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure your Aiola API connection and authentication"})]}),e.jsxs("div",{className:"config-dialog__field-group",children:[e.jsx(m,{htmlFor:"api-key",className:"config-dialog__label config-dialog__label--required",children:"API Key / Access Token"}),e.jsx(S,{id:"api-key",type:"password",value:t[t.environment].connection.apiKey,onChange:n=>{const s=n.target.value;console.log("[ConfigDialog] API key changed:",{hasValue:!!s,length:s.length,preview:s.substring(0,10)+(s.length>10?"...":"")});const i=t.environment,r={...t,[i]:{...t[i],connection:{...t[i].connection,apiKey:s}}};f(r);const u={...r,[i]:{...r[i],stt:{...r[i].stt,rememberFlowid:r[i].stt.rememberFlowid}}};localStorage.setItem("aiola-settings",JSON.stringify(u)),d(u)},placeholder:"Enter your Aiola API key",className:"config-dialog__input"})]}),e.jsxs("div",{className:"config-dialog__field-group",children:[e.jsx(m,{htmlFor:"workflowId",className:"config-dialog__label",children:"Workflow ID"}),e.jsx(S,{id:"workflowId",value:t[t.environment].connection.workflowId||"",onChange:n=>{const s=n.target.value;console.log("[ConfigDialog] Workflow ID changed:",{from:t[t.environment].connection.workflowId||"",to:s,hasValue:!!s});const i=t.environment;f({...t,[i]:{...t[i],connection:{...t[i].connection,workflowId:n.target.value}}})},placeholder:"Enter workflow ID for STT processing",className:"config-dialog__input"}),e.jsx("p",{className:"config-dialog__helper-text",children:"Optional: SDK will use default workflow if empty"})]}),e.jsxs("div",{className:"config-dialog__field-group",children:[e.jsx(m,{className:"config-dialog__label",children:"Environment"}),e.jsxs("div",{className:"config-dialog__toggle-container",children:[e.jsx("button",{type:"button",onClick:()=>A("prod"),className:`config-dialog__toggle-button ${t.environment==="prod"?"config-dialog__toggle-button--active":""}`,children:"Prod"}),e.jsx("button",{type:"button",onClick:()=>A("dev"),className:`config-dialog__toggle-button ${t.environment==="dev"?"config-dialog__toggle-button--active":""}`,children:"Dev"})]}),e.jsx("p",{className:"config-dialog__helper-text",children:"Select the API environment: Production or Development"})]})]}),e.jsxs("section",{className:"config-dialog__section",children:[e.jsxs("div",{className:"config-dialog__section-header",children:[e.jsx("h3",{className:"config-dialog__section-title",children:"Speech-to-Text"}),e.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure speech recognition settings and language preferences"})]}),e.jsxs("div",{className:"config-dialog__field-group",children:[e.jsx(m,{htmlFor:"stt-language",className:"config-dialog__label config-dialog__label--required",children:"Language/Accent"}),e.jsxs(P,{value:t[t.environment].stt.language,onValueChange:n=>{var i;console.log("[ConfigDialog] STT language changed:",{from:t[t.environment].stt.language,to:n,languageLabel:(i=V.find(r=>r.value===n))==null?void 0:i.label});const s=t.environment;f({...t,[s]:{...t[s],stt:{...t[s].stt,language:n}}})},children:[e.jsx(C,{className:"config-dialog__select",children:e.jsx(U,{placeholder:"Select language"})}),e.jsx(k,{children:V.map(n=>e.jsx(I,{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{className:"config-dialog__field-group",children:[e.jsx(m,{htmlFor:"keywords",className:"config-dialog__label",children:"Keywords"}),e.jsx(Y,{id:"keywords",value:t[t.environment].stt.keywords.join(", "),onChange:n=>{const s=n.target.value.split(",").map(r=>r.trim()).filter(Boolean);console.log("[ConfigDialog] STT keywords changed:",{from:t[t.environment].stt.keywords,to:s,count:s.length});const i=t.environment;f({...t,[i]:{...t[i],stt:{...t[i].stt,keywords:s}}})},placeholder:"[word1, word2] or [{'A Yo La': 'aiola'}, {'bay tar': 'beitar'}]",rows:3,className:"config-dialog__textarea"}),e.jsx("p",{className:"config-dialog__helper-text",children:"Comma-separated keywords to improve recognition accuracy"})]}),e.jsxs("div",{className:"config-dialog__field-group",children:[e.jsx(m,{className:"config-dialog__label",children:"VAD Config"}),e.jsx("div",{className:"config-dialog__info-box",children:e.jsx("p",{className:"config-dialog__info-text",children:"Using SDK defaults (no override available)"})})]})]}),e.jsxs("section",{className:"config-dialog__section",children:[e.jsxs("div",{className:"config-dialog__section-header",children:[e.jsx("h3",{className:"config-dialog__section-title",children:"Text-to-Speech"}),e.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure voice synthesis settings and voice selection"})]}),e.jsxs("div",{className:"config-dialog__field-group",children:[e.jsx(m,{htmlFor:"tts-voice",className:"config-dialog__label",children:"Voice"}),e.jsxs(P,{value:t[t.environment].tts.voice,onValueChange:n=>{var i;console.log("[ConfigDialog] TTS voice changed:",{from:t[t.environment].tts.voice,to:n,voiceLabel:(i=B.find(r=>r.value===n))==null?void 0:i.label});const s=t.environment;f({...t,[s]:{...t[s],tts:{...t[s].tts,voice:n}}})},children:[e.jsx(C,{className:"config-dialog__select",children:e.jsx(U,{placeholder:"Select voice"})}),e.jsx(k,{children:B.map(n=>e.jsx(I,{value:n.value,children:n.label},n.value))})]})]}),e.jsx("div",{className:"config-dialog__info-box",children:e.jsx("p",{className:"config-dialog__info-text",children:"Language/Accent: Fixed to English (en) - non-editable"})})]})]}),e.jsx("div",{className:"config-dialog__footer",children:e.jsxs("div",{className:"config-dialog__button-container",children:[e.jsx("div",{className:"config_buttons",children:e.jsx(ge,{onClick:te,disabled:T,className:"config-dialog__button config-dialog__button--primary",children:T?"Connecting...":D&&K?"Reload":"Connect"})}),e.jsx("div",{className:"config-dialog__info-box",children:e.jsx("p",{className:"config-dialog__info-text",children:"All configuration settings are automatically cached and will be remembered for future sessions"})})]})})]})}):null}export{ke as ConfigDialog};
