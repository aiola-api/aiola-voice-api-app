import{j as n,k as z,a as H}from"./ui-c6rpaoQp.js";import{r as g}from"./vendor-B6OAZll8.js";import{c as M,a as E,u as Y,S as K,b as B,d as P,e as O,f as $,B as Q}from"./index-w9IHTu8l.js";import{u as X}from"./useConnection-DsvzRGQK.js";import{t as h}from"./utils-E4Pq5uL6.js";import"./state-BMzes8HB.js";import"./icons-BcCThlEi.js";import"./sdk-_0emOJGD.js";const f=g.forwardRef(({className:i,type:l,...d},v)=>n.jsx("input",{type:l,className:M("Input",E("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i)),ref:v,...d}));f.displayName="Input";const ee=H("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),r=g.forwardRef(({className:i,...l},d)=>n.jsx(z,{ref:d,className:E(ee(),i),...l}));r.displayName=z.displayName;const I=g.forwardRef(({className:i,...l},d)=>n.jsx("textarea",{className:E("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:d,...l}));I.displayName="Textarea";const q=[{value:"en_US",label:"English (US)"},{value:"en_GB",label:"English (UK)"},{value:"es_ES",label:"Spanish (Spain)"},{value:"fr_FR",label:"French (France)"},{value:"de_DE",label:"German (Germany)"},{value:"it_IT",label:"Italian (Italy)"},{value:"pt_BR",label:"Portuguese (Brazil)"},{value:"ja_JP",label:"Japanese (Japan)"},{value:"ko_KR",label:"Korean (Korea)"},{value:"zh_CN",label:"Chinese (China)"}],G=[{value:"tara",label:"Tara"},{value:"zoe",label:"Zoe"},{value:"zac",label:"Zac"},{value:"dan",label:"Dan"},{value:"jess",label:"Jess"},{value:"leo",label:"Leo"},{value:"mia",label:"Mia"},{value:"julia",label:"Julia"},{value:"leah",label:"Leah"}];function k(i){const l=i.environment;return{apiKey:i[l].connection.apiKey,baseUrl:i[l].connection.baseUrl,authBaseUrl:i[l].connection.authBaseUrl,workflowId:i[l].connection.workflowId,stt:i[l].stt,tts:i[l].tts}}function ne(i,l,d){return{...i,environment:l,[l]:{connection:{...i[l].connection,...d.connection},stt:{...i[l].stt,...d.stt},tts:{...i[l].tts,...d.tts}}}}function de({open:i,onOpenChange:l}){const[d,v]=Y(),[e,c]=g.useState(d),[T,U]=g.useState(!1),[A,x]=g.useState(!1),[b,_]=g.useState(null),{createSession:W,isConnected:F}=X(),D=g.useRef(null),L=g.useCallback((o,t)=>{var V;const a=k(o),s=k(t),m=t.environment,u=o.environment!==t.environment,p=a.apiKey!==s.apiKey,N=a.stt.language!==s.stt.language,y=JSON.stringify(a.stt.keywords)!==JSON.stringify(s.stt.keywords),J=JSON.stringify(a.stt.schemaValues)!==JSON.stringify(s.stt.schemaValues),w=a.workflowId!==s.workflowId,S=a.stt.rememberFlowid!==s.stt.rememberFlowid,C=a.tts.voice!==s.tts.voice,R=JSON.stringify(a.stt.vad)!==JSON.stringify(s.stt.vad);return(u||p||N||y||w||S||C||R)&&console.log(`[checkSettingsChanged] Settings changed detected for ${m} environment:`,{environment:{changed:u,from:o.environment,to:m},apiKey:{changed:p,currentLength:((V=s.apiKey)==null?void 0:V.length)||0},stt:{languageChanged:N,keywordsChanged:y,schemaValuesChanged:J,rememberFlowidChanged:S,workflowIdChanged:w,vadConfigChanged:R},tts:{voiceChanged:C}}),p||u||N||y||J||w||S||C},[]),j=g.useCallback(o=>{const t=e.environment,s={...ne(e,t,k(e)),environment:o};console.log("ConfigDialog: Switching environment to",o),console.log("ConfigDialog: New temp settings:",s),c(s),x(!0)},[e]);g.useEffect(()=>{i&&(c(d),x(!1))},[i]),g.useEffect(()=>{i&&x(L(d,e))},[e,d,i,L]),g.useEffect(()=>{if(!i)return;const o=t=>{var u;const a=t.target,s=(u=D.current)==null?void 0:u.contains(a),m=a.closest(`
        [data-radix-select-viewport],
        [data-radix-popover-content],
        [data-radix-select-content],
        [data-radix-menu-content],
        [role="option"],
        [role="listbox"],
        [role="menu"],
        [role="combobox"],
        [data-state="open"],
        [data-radix-collection-item]
      `);!s&&!m&&l(!1)};return document.addEventListener("mousedown",o,!0),()=>{document.removeEventListener("mousedown",o,!0)}},[i,l]);const Z=async()=>{const o=e.environment;if(!e[o].connection.apiKey.trim()){h.error("API Key is required");return}if(o==="custom"){if(!e.custom.connection.baseUrl.trim()){h.error("Base URL is required for custom environment");return}if(!e.custom.connection.authBaseUrl.trim()){h.error("Auth URL is required for custom environment");return}try{new URL(e.custom.connection.baseUrl)}catch{h.error("Base URL must be a valid URL");return}try{new URL(e.custom.connection.authBaseUrl)}catch{h.error("Auth URL must be a valid URL");return}}if(A&&F){const t={...e,[o]:{...e[o],stt:{...e[o].stt,rememberFlowid:e[o].stt.rememberFlowid}}};v(t),localStorage.setItem("aiola-settings",JSON.stringify(t)),h.success("Settings saved - Reloading page to apply changes"),l(!1),setTimeout(()=>{window.location.reload()},1e3);return}U(!0);try{await W(!0);const t={...e,[o]:{...e[o],stt:{...e[o].stt,rememberFlowid:e[o].stt.rememberFlowid}}};v(t),localStorage.setItem("aiola-settings",JSON.stringify(t)),h.success("Settings saved successfully - Connection verified"),l(!1)}catch(t){console.warn("Connection test failed, but saving settings anyway:",t);const a={...e,[o]:{...e[o],stt:{...e[o].stt,rememberFlowid:e[o].stt.rememberFlowid}}};v(a),localStorage.setItem("aiola-settings",JSON.stringify(a)),h.warning(`Settings saved but connection failed: ${t instanceof Error?t.message:"Unknown error"}`),l(!1)}finally{U(!1)}};return i?n.jsx("div",{className:M("ConfigDialog","config-dialog__container"),children:n.jsxs("div",{ref:D,className:"config-dialog__content",onClick:o=>{o.stopPropagation()},children:[n.jsxs("div",{className:"config-dialog__header",children:[n.jsxs("div",{className:"config-dialog__header-content",children:[n.jsx("h2",{className:"config-dialog__title",children:"Configuration"}),n.jsx("button",{onClick:()=>l(!1),className:"config-dialog__close-button","aria-label":"Close configuration",children:"Ã—"})]}),n.jsx("p",{className:"config-dialog__description",children:"Configure your Aiola API settings, speech-to-text, and text-to-speech preferences."})]}),n.jsxs("div",{className:"config-dialog__main",children:[n.jsxs("section",{className:"config-dialog__section",children:[n.jsxs("div",{className:"config-dialog__section-header",children:[n.jsx("h3",{className:"config-dialog__section-title",children:"Connection"}),n.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure your Aiola API connection and authentication"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(r,{htmlFor:"api-key",className:"config-dialog__label config-dialog__label--required",children:"API Key / Access Token"}),n.jsx(f,{id:"api-key",type:"password",value:e[e.environment].connection.apiKey,onChange:o=>{const t=o.target.value;console.log("[ConfigDialog] API key changed:",{hasValue:!!t,length:t.length,preview:t.substring(0,10)+(t.length>10?"...":"")});const a=e.environment,s={...e,[a]:{...e[a],connection:{...e[a].connection,apiKey:t}}};c(s);const m={...s,[a]:{...s[a],stt:{...s[a].stt,rememberFlowid:s[a].stt.rememberFlowid}}};localStorage.setItem("aiola-settings",JSON.stringify(m)),v(m)},placeholder:"Enter your Aiola API key",className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(r,{htmlFor:"workflowId",className:"config-dialog__label",children:"Workflow ID"}),n.jsx(f,{id:"workflowId",value:e[e.environment].connection.workflowId||"",onChange:o=>{const t=o.target.value;console.log("[ConfigDialog] Workflow ID changed:",{from:e[e.environment].connection.workflowId||"",to:t,hasValue:!!t});const a=e.environment;c({...e,[a]:{...e[a],connection:{...e[a].connection,workflowId:o.target.value}}})},placeholder:"Enter workflow ID for STT processing",className:"config-dialog__input"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Optional: SDK will use default workflow if empty"}),e.environment==="custom"&&n.jsx("p",{className:"config-dialog__helper-text",style:{marginTop:"0.5rem",fontStyle:"italic"},children:"Note: Default workflowId may not work with custom environments"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(r,{className:"config-dialog__label",children:"Environment"}),n.jsxs("div",{className:"config-dialog__toggle-container",children:[n.jsx("button",{type:"button",onClick:()=>j("prod"),className:`config-dialog__toggle-button ${e.environment==="prod"?"config-dialog__toggle-button--active":""}`,children:"Prod"}),n.jsx("button",{type:"button",onClick:()=>j("dev"),className:`config-dialog__toggle-button ${e.environment==="dev"?"config-dialog__toggle-button--active":""}`,children:"Dev"}),n.jsx("button",{type:"button",onClick:()=>j("custom"),className:`config-dialog__toggle-button ${e.environment==="custom"?"config-dialog__toggle-button--active":""}`,children:"Custom"})]}),n.jsx("p",{className:"config-dialog__helper-text",children:"Select the API environment: Production, Development, or Custom"})]}),e.environment==="custom"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(r,{htmlFor:"custom-base-url",className:"config-dialog__label config-dialog__label--required",children:"Base URL"}),n.jsx(f,{id:"custom-base-url",type:"url",value:e.custom.connection.baseUrl,onChange:o=>{const t=o.target.value;c({...e,custom:{...e.custom,connection:{...e.custom.connection,baseUrl:t}}})},placeholder:"https://your-api.example.com",className:"config-dialog__input"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Enter the base URL for your custom API environment"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(r,{htmlFor:"custom-auth-url",className:"config-dialog__label config-dialog__label--required",children:"Auth URL"}),n.jsx(f,{id:"custom-auth-url",type:"url",value:e.custom.connection.authBaseUrl,onChange:o=>{const t=o.target.value;c({...e,custom:{...e.custom,connection:{...e.custom.connection,authBaseUrl:t}}})},placeholder:"https://your-auth.example.com",className:"config-dialog__input"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Enter the authentication URL for your custom API environment"})]})]})]}),n.jsxs("section",{className:"config-dialog__section",children:[n.jsxs("div",{className:"config-dialog__section-header",children:[n.jsx("h3",{className:"config-dialog__section-title",children:"Speech-to-Text"}),n.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure speech recognition settings and language preferences"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(r,{htmlFor:"stt-language",className:"config-dialog__label config-dialog__label--required",children:"Language/Accent"}),n.jsxs(K,{value:e[e.environment].stt.language,onValueChange:o=>{var a;console.log("[ConfigDialog] STT language changed:",{from:e[e.environment].stt.language,to:o,languageLabel:(a=q.find(s=>s.value===o))==null?void 0:a.label});const t=e.environment;c({...e,[t]:{...e[t],stt:{...e[t].stt,language:o}}})},children:[n.jsx(B,{className:"config-dialog__select",children:n.jsx(P,{placeholder:"Select language"})}),n.jsx(O,{children:q.map(o=>n.jsx($,{value:o.value,children:o.label},o.value))})]})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(r,{htmlFor:"keywords",className:"config-dialog__label",children:"Keywords"}),n.jsx(I,{id:"keywords",value:e[e.environment].stt.keywords.join(", "),onChange:o=>{const t=o.target.value.split(",").map(s=>s.trim()).filter(Boolean);console.log("[ConfigDialog] STT keywords changed:",{from:e[e.environment].stt.keywords,to:t,count:t.length});const a=e.environment;c({...e,[a]:{...e[a],stt:{...e[a].stt,keywords:t}}})},placeholder:"[word1, word2] or [{'A Yo La': 'aiola'}, {'bay tar': 'beitar'}]",rows:3,className:"config-dialog__textarea"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Comma-separated keywords to improve recognition accuracy"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(r,{htmlFor:"schema-values",className:"config-dialog__label",children:"Schema Values"}),n.jsx(I,{id:"schema-values",value:JSON.stringify(e[e.environment].stt.schemaValues,null,2),onChange:o=>{const t=o.target.value.trim(),a=e.environment;if(t===""){_(null),c({...e,[a]:{...e[a],stt:{...e[a].stt,schemaValues:{}}}});return}try{const s=JSON.parse(t);if(typeof s!="object"||s===null||Array.isArray(s)){_("Schema values must be an object");return}for(const[m,u]of Object.entries(s)){if(!Array.isArray(u)){_(`Value for "${m}" must be an array`);return}for(const p of u)if(typeof p!="string"&&typeof p!="number"){_(`Items in "${m}" array must be strings or numbers`);return}}_(null),console.log("[ConfigDialog] STT schema values changed:",{from:e[a].stt.schemaValues,to:s}),c({...e,[a]:{...e[a],stt:{...e[a].stt,schemaValues:s}}})}catch(s){_(s instanceof Error?`Invalid JSON: ${s.message}`:"Invalid JSON format")}},placeholder:'{"contact.name": ["John Doe", "Jane Smith"], "contact.email": ["john@example.com"]}',rows:6,className:`config-dialog__textarea ${b?"config-dialog__textarea--error":""}`}),b&&n.jsx("p",{className:"config-dialog__error-text",children:b}),n.jsxs("p",{className:"config-dialog__helper-text",children:["JSON object with dot-notation keys mapping to arrays of strings or numbers. Supports copy/paste. Example: ","{",'"contact.name": ["John Doe", "Jane Smith"]',"}"]})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(r,{className:"config-dialog__label",children:"VAD Config"}),n.jsxs("div",{className:"config-dialog__vad-config",children:[n.jsx("div",{className:"config-dialog__vad-toggle",children:n.jsxs("label",{className:"config-dialog__checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:typeof e[e.environment].stt.vad=="object",onChange:o=>{const t=e.environment;c({...e,[t]:{...e[t],stt:{...e[t].stt,vad:o.target.checked?{threshold:.5,min_speech_ms:250,min_silence_ms:500,max_segment_ms:3e4}:"default"}}})},className:"config-dialog__checkbox"}),n.jsx("span",{children:"Use custom VAD configuration"})]})}),typeof e[e.environment].stt.vad=="object"&&n.jsxs("div",{className:"config-dialog__vad-fields",children:[n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(r,{htmlFor:"vad-threshold",className:"config-dialog__vad-label",children:"Threshold (0.0 - 1.0)"}),n.jsx(f,{id:"vad-threshold",type:"number",min:"0",max:"1",step:"0.1",value:e[e.environment].stt.vad.threshold||.5,onChange:o=>{const t=e.environment,a=e[t].stt.vad;c({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...a,threshold:parseFloat(o.target.value)||.5}}}})},className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(r,{htmlFor:"vad-min-speech",className:"config-dialog__vad-label",children:"Min Speech (ms)"}),n.jsx(f,{id:"vad-min-speech",type:"number",min:"0",value:e[e.environment].stt.vad.min_speech_ms||250,onChange:o=>{const t=e.environment,a=e[t].stt.vad;c({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...a,min_speech_ms:parseInt(o.target.value)||250}}}})},className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(r,{htmlFor:"vad-min-silence",className:"config-dialog__vad-label",children:"Min Silence (ms)"}),n.jsx(f,{id:"vad-min-silence",type:"number",min:"0",value:e[e.environment].stt.vad.min_silence_ms||500,onChange:o=>{const t=e.environment,a=e[t].stt.vad;c({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...a,min_silence_ms:parseInt(o.target.value)||500}}}})},className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(r,{htmlFor:"vad-max-segment",className:"config-dialog__vad-label",children:"Max Segment (ms)"}),n.jsx(f,{id:"vad-max-segment",type:"number",min:"0",value:e[e.environment].stt.vad.max_segment_ms||3e4,onChange:o=>{const t=e.environment,a=e[t].stt.vad;c({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...a,max_segment_ms:parseInt(o.target.value)||3e4}}}})},className:"config-dialog__input"})]})]})]})]})]}),n.jsxs("section",{className:"config-dialog__section",children:[n.jsxs("div",{className:"config-dialog__section-header",children:[n.jsx("h3",{className:"config-dialog__section-title",children:"Text-to-Speech"}),n.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure voice synthesis settings and voice selection"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(r,{htmlFor:"tts-voice",className:"config-dialog__label",children:"Voice"}),n.jsxs(K,{value:e[e.environment].tts.voice,onValueChange:o=>{var a;console.log("[ConfigDialog] TTS voice changed:",{from:e[e.environment].tts.voice,to:o,voiceLabel:(a=G.find(s=>s.value===o))==null?void 0:a.label});const t=e.environment;c({...e,[t]:{...e[t],tts:{...e[t].tts,voice:o}}})},children:[n.jsx(B,{className:"config-dialog__select",children:n.jsx(P,{placeholder:"Select voice"})}),n.jsx(O,{children:G.map(o=>n.jsx($,{value:o.value,children:o.label},o.value))})]})]}),n.jsx("div",{className:"config-dialog__info-box",children:n.jsx("p",{className:"config-dialog__info-text",children:"Language/Accent: Fixed to English (en) - non-editable"})})]})]}),n.jsx("div",{className:"config-dialog__footer",children:n.jsxs("div",{className:"config-dialog__button-container",children:[n.jsx("div",{className:"config_buttons",children:n.jsx(Q,{onClick:Z,disabled:T,className:"config-dialog__button config-dialog__button--primary",children:T?"Connecting...":A&&F?"Reload":"Connect"})}),n.jsx("div",{className:"config-dialog__info-box",children:n.jsx("p",{className:"config-dialog__info-text",children:"All configuration settings are automatically cached and will be remembered for future sessions"})})]})})]})}):null}export{de as ConfigDialog};
