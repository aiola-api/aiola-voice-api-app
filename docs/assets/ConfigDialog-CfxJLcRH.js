import{j as n,k as Q,a as se}from"./ui-c6rpaoQp.js";import{r}from"./vendor-B6OAZll8.js";import{c as X,a as U,u as ie,S as q,b as G,d as z,e as M,f as W,B as Z}from"./index-BQsVrmoX.js";import{u as le}from"./useConnection-Dk6X9pgg.js";import{u as re}from"./useSTT-Dywz2mRs.js";import{t as f}from"./utils-E4Pq5uL6.js";import"./state-BMzes8HB.js";import"./icons-BcCThlEi.js";import"./sdk-_0emOJGD.js";const h=r.forwardRef(({className:i,type:l,...c},v)=>n.jsx("input",{type:l,className:X("Input",U("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i)),ref:v,...c}));h.displayName="Input";const ce=se("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),g=r.forwardRef(({className:i,...l},c)=>n.jsx(Q,{ref:c,className:U(ce(),i),...l}));g.displayName=Q.displayName;const T=r.forwardRef(({className:i,...l},c)=>n.jsx("textarea",{className:U("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:c,...l}));T.displayName="Textarea";const H=[{value:"en_US",label:"English (US)"},{value:"en_GB",label:"English (UK)"},{value:"es_ES",label:"Spanish (Spain)"},{value:"fr_FR",label:"French (France)"},{value:"de_DE",label:"German (Germany)"},{value:"it_IT",label:"Italian (Italy)"},{value:"pt_BR",label:"Portuguese (Brazil)"},{value:"ja_JP",label:"Japanese (Japan)"},{value:"ko_KR",label:"Korean (Korea)"},{value:"zh_CN",label:"Chinese (China)"}],Y=[{value:"tara",label:"Tara"},{value:"zoe",label:"Zoe"},{value:"zac",label:"Zac"},{value:"dan",label:"Dan"},{value:"jess",label:"Jess"},{value:"leo",label:"Leo"},{value:"mia",label:"Mia"},{value:"julia",label:"Julia"},{value:"leah",label:"Leah"}];function V(i){const l=i.environment;return{apiKey:i[l].connection.apiKey,baseUrl:i[l].connection.baseUrl,authBaseUrl:i[l].connection.authBaseUrl,workflowId:i[l].connection.workflowId,stt:i[l].stt,tts:i[l].tts}}function de(i,l,c){return{...i,environment:l,[l]:{connection:{...i[l].connection,...c.connection},stt:{...i[l].stt,...c.stt},tts:{...i[l].tts,...c.tts}}}}function be({open:i,onOpenChange:l}){const[c,v]=ie(),[e,d]=r.useState(c),[A,F]=r.useState(!1),[R,b]=r.useState(!1),[_,p]=r.useState(null),[L,j]=r.useState(!1),[D,N]=r.useState(""),{createSession:ee,isConnected:x}=le(),{createStreamConnection:ne}=re(),J=r.useRef(null),K=r.useRef(null),B=r.useCallback((a,t)=>{var $;const o=V(a),s=V(t),m=t.environment,u=a.environment!==t.environment,w=o.apiKey!==s.apiKey,S=o.stt.language!==s.stt.language,C=JSON.stringify(o.stt.keywords)!==JSON.stringify(s.stt.keywords),P=JSON.stringify(o.stt.schemaValues)!==JSON.stringify(s.stt.schemaValues),k=o.workflowId!==s.workflowId,I=o.stt.rememberFlowid!==s.stt.rememberFlowid,E=o.tts.voice!==s.tts.voice,O=JSON.stringify(o.stt.vad)!==JSON.stringify(s.stt.vad);return(u||w||S||C||k||I||E||O)&&console.log(`[checkSettingsChanged] Settings changed detected for ${m} environment:`,{environment:{changed:u,from:a.environment,to:m},apiKey:{changed:w,currentLength:(($=s.apiKey)==null?void 0:$.length)||0},stt:{languageChanged:S,keywordsChanged:C,schemaValuesChanged:P,rememberFlowidChanged:I,workflowIdChanged:k,vadConfigChanged:O},tts:{voiceChanged:E}}),w||u||S||C||P||k||I||E},[]),y=r.useCallback(a=>{const t=e.environment,s={...de(e,t,V(e)),environment:a};console.log("ConfigDialog: Switching environment to",a),console.log("ConfigDialog: New temp settings:",s),d(s),b(!0)},[e]);r.useEffect(()=>{if(i){d(c),b(!1);const a=c.environment,t=c[a].stt.schemaValues;Object.keys(t).length===0?N(""):N(JSON.stringify(t,null,2)),p(null)}},[i]),r.useEffect(()=>{i&&b(B(c,e))},[e,c,i,B]),r.useEffect(()=>{if(!i)return;const a=t=>{var u;const o=t.target,s=(u=J.current)==null?void 0:u.contains(o),m=o.closest(`
        [data-radix-select-viewport],
        [data-radix-popover-content],
        [data-radix-select-content],
        [data-radix-menu-content],
        [role="option"],
        [role="listbox"],
        [role="menu"],
        [role="combobox"],
        [data-state="open"],
        [data-radix-collection-item]
      `);!s&&!m&&l(!1)};return document.addEventListener("mousedown",a,!0),()=>{document.removeEventListener("mousedown",a,!0)}},[i,l]);const te=async()=>{const a=e.environment;if(!e[a].connection.apiKey.trim()){f.error("API Key is required");return}if(a==="custom"){if(!e.custom.connection.baseUrl.trim()){f.error("Base URL is required for custom environment");return}if(!e.custom.connection.authBaseUrl.trim()){f.error("Auth URL is required for custom environment");return}try{new URL(e.custom.connection.baseUrl)}catch{f.error("Base URL must be a valid URL");return}try{new URL(e.custom.connection.authBaseUrl)}catch{f.error("Auth URL must be a valid URL");return}}if(R&&x){const t={...e,[a]:{...e[a],stt:{...e[a].stt,rememberFlowid:e[a].stt.rememberFlowid}}};v(t),localStorage.setItem("aiola-settings",JSON.stringify(t)),f.success("Settings saved - Reloading page to apply changes"),l(!1),setTimeout(()=>{window.location.reload()},1e3);return}F(!0);try{await ee(!0);const t={...e,[a]:{...e[a],stt:{...e[a].stt,rememberFlowid:e[a].stt.rememberFlowid}}};v(t),localStorage.setItem("aiola-settings",JSON.stringify(t)),f.success("Settings saved successfully - Connection verified"),l(!1)}catch(t){console.warn("Connection test failed, but saving settings anyway:",t);const o={...e,[a]:{...e[a],stt:{...e[a].stt,rememberFlowid:e[a].stt.rememberFlowid}}};v(o),localStorage.setItem("aiola-settings",JSON.stringify(o)),f.warning(`Settings saved but connection failed: ${t instanceof Error?t.message:"Unknown error"}`),l(!1)}finally{F(!1)}},ae=r.useCallback(a=>{const t=a.trim();if(t==="")return{isValid:!0,error:null,parsed:{}};try{const o=JSON.parse(t);if(typeof o!="object"||o===null||Array.isArray(o))return{isValid:!1,error:"Schema values must be an object"};for(const[s,m]of Object.entries(o)){if(!Array.isArray(m))return{isValid:!1,error:`Value for "${s}" must be an array`};for(const u of m)if(typeof u!="string"&&typeof u!="number")return{isValid:!1,error:`Items in "${s}" array must be strings or numbers`}}return{isValid:!0,error:null,parsed:o}}catch(o){return{isValid:!1,error:o instanceof Error?`Invalid JSON: ${o.message}`:"Invalid JSON format"}}},[]),oe=async()=>{const t=ae(D);if(!t.isValid){p(t.error);const s=K.current;s&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.focus()),f.error(`Schema values validation failed: ${t.error}`);return}p(null);const o=e.environment;if(d({...e,[o]:{...e[o],stt:{...e[o].stt,schemaValues:t.parsed||{}}}}),!x){f.error("Please connect first before setting schema values");return}j(!0);try{const s=await ne(),m=t.parsed||{};s.setSchemaValues(m,u=>{u.status==="ok"?(f.success("Schema values set successfully"),console.log("✅ Schema values set successfully:",m)):(f.warning(`Schema values set with warning: ${u.message||"Unknown warning"}`),console.warn("⚠️ Schema values set with warning:",u.message)),j(!1)})}catch(s){console.error("❌ Error setting schema values:",s),f.error(`Failed to set schema values: ${s instanceof Error?s.message:"Unknown error"}`),j(!1)}};return i?n.jsx("div",{className:X("ConfigDialog","config-dialog__container"),children:n.jsxs("div",{ref:J,className:"config-dialog__content",onClick:a=>{a.stopPropagation()},children:[n.jsxs("div",{className:"config-dialog__header",children:[n.jsxs("div",{className:"config-dialog__header-content",children:[n.jsx("h2",{className:"config-dialog__title",children:"Configuration"}),n.jsx("button",{onClick:()=>l(!1),className:"config-dialog__close-button","aria-label":"Close configuration",children:"×"})]}),n.jsx("p",{className:"config-dialog__description",children:"Configure your Aiola API settings, speech-to-text, and text-to-speech preferences."})]}),n.jsxs("div",{className:"config-dialog__main",children:[n.jsxs("section",{className:"config-dialog__section",children:[n.jsxs("div",{className:"config-dialog__section-header",children:[n.jsx("h3",{className:"config-dialog__section-title",children:"Connection"}),n.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure your Aiola API connection and authentication"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(g,{htmlFor:"api-key",className:"config-dialog__label config-dialog__label--required",children:"API Key / Access Token"}),n.jsx(h,{id:"api-key",type:"password",value:e[e.environment].connection.apiKey,onChange:a=>{const t=a.target.value;console.log("[ConfigDialog] API key changed:",{hasValue:!!t,length:t.length,preview:t.substring(0,10)+(t.length>10?"...":"")});const o=e.environment,s={...e,[o]:{...e[o],connection:{...e[o].connection,apiKey:t}}};d(s);const m={...s,[o]:{...s[o],stt:{...s[o].stt,rememberFlowid:s[o].stt.rememberFlowid}}};localStorage.setItem("aiola-settings",JSON.stringify(m)),v(m)},placeholder:"Enter your Aiola API key",className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(g,{htmlFor:"workflowId",className:"config-dialog__label",children:"Workflow ID"}),n.jsx(h,{id:"workflowId",value:e[e.environment].connection.workflowId||"",onChange:a=>{const t=a.target.value;console.log("[ConfigDialog] Workflow ID changed:",{from:e[e.environment].connection.workflowId||"",to:t,hasValue:!!t});const o=e.environment;d({...e,[o]:{...e[o],connection:{...e[o].connection,workflowId:a.target.value}}})},placeholder:"Enter workflow ID for STT processing",className:"config-dialog__input"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Optional: SDK will use default workflow if empty"}),e.environment==="custom"&&n.jsx("p",{className:"config-dialog__helper-text",style:{marginTop:"0.5rem",fontStyle:"italic"},children:"Note: Default workflowId may not work with custom environments"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(g,{className:"config-dialog__label",children:"Environment"}),n.jsxs("div",{className:"config-dialog__toggle-container",children:[n.jsx("button",{type:"button",onClick:()=>y("prod"),className:`config-dialog__toggle-button ${e.environment==="prod"?"config-dialog__toggle-button--active":""}`,children:"Prod"}),n.jsx("button",{type:"button",onClick:()=>y("dev"),className:`config-dialog__toggle-button ${e.environment==="dev"?"config-dialog__toggle-button--active":""}`,children:"Dev"}),n.jsx("button",{type:"button",onClick:()=>y("custom"),className:`config-dialog__toggle-button ${e.environment==="custom"?"config-dialog__toggle-button--active":""}`,children:"Custom"})]}),n.jsx("p",{className:"config-dialog__helper-text",children:"Select the API environment: Production, Development, or Custom"})]}),e.environment==="custom"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(g,{htmlFor:"custom-base-url",className:"config-dialog__label config-dialog__label--required",children:"Base URL"}),n.jsx(h,{id:"custom-base-url",type:"url",value:e.custom.connection.baseUrl,onChange:a=>{const t=a.target.value;d({...e,custom:{...e.custom,connection:{...e.custom.connection,baseUrl:t}}})},placeholder:"https://your-api.example.com",className:"config-dialog__input"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Enter the base URL for your custom API environment"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(g,{htmlFor:"custom-auth-url",className:"config-dialog__label config-dialog__label--required",children:"Auth URL"}),n.jsx(h,{id:"custom-auth-url",type:"url",value:e.custom.connection.authBaseUrl,onChange:a=>{const t=a.target.value;d({...e,custom:{...e.custom,connection:{...e.custom.connection,authBaseUrl:t}}})},placeholder:"https://your-auth.example.com",className:"config-dialog__input"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Enter the authentication URL for your custom API environment"})]})]})]}),n.jsxs("section",{className:"config-dialog__section",children:[n.jsxs("div",{className:"config-dialog__section-header",children:[n.jsx("h3",{className:"config-dialog__section-title",children:"Speech-to-Text"}),n.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure speech recognition settings and language preferences"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(g,{htmlFor:"stt-language",className:"config-dialog__label config-dialog__label--required",children:"Language/Accent"}),n.jsxs(q,{value:e[e.environment].stt.language,onValueChange:a=>{var o;console.log("[ConfigDialog] STT language changed:",{from:e[e.environment].stt.language,to:a,languageLabel:(o=H.find(s=>s.value===a))==null?void 0:o.label});const t=e.environment;d({...e,[t]:{...e[t],stt:{...e[t].stt,language:a}}})},children:[n.jsx(G,{className:"config-dialog__select",children:n.jsx(z,{placeholder:"Select language"})}),n.jsx(M,{children:H.map(a=>n.jsx(W,{value:a.value,children:a.label},a.value))})]})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(g,{htmlFor:"keywords",className:"config-dialog__label",children:"Keywords"}),n.jsx(T,{id:"keywords",value:e[e.environment].stt.keywords.join(", "),onChange:a=>{const t=a.target.value.split(",").map(s=>s.trim()).filter(Boolean);console.log("[ConfigDialog] STT keywords changed:",{from:e[e.environment].stt.keywords,to:t,count:t.length});const o=e.environment;d({...e,[o]:{...e[o],stt:{...e[o].stt,keywords:t}}})},placeholder:"[word1, word2] or [{'A Yo La': 'aiola'}, {'bay tar': 'beitar'}]",rows:3,className:"config-dialog__textarea"}),n.jsx("p",{className:"config-dialog__helper-text",children:"Comma-separated keywords to improve recognition accuracy"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(g,{htmlFor:"schema-values",className:"config-dialog__label",children:"Schema Values"}),n.jsx(T,{ref:K,id:"schema-values",value:D,onChange:a=>{N(a.target.value),_&&p(null)},placeholder:'{"contact.name": ["John Doe", "Jane Smith"], "contact.email": ["john@example.com"]}',rows:6,className:`config-dialog__textarea ${_?"config-dialog__textarea--error":""}`}),_?n.jsx("p",{className:"config-dialog__error-text",children:_}):n.jsxs("p",{className:"config-dialog__helper-text",children:["JSON object with dot-notation keys mapping to arrays of strings or numbers. Supports copy/paste. Example: ","{",'"contact.name": ["John Doe", "Jane Smith"]',"}"]}),n.jsx("div",{style:{marginTop:"0.75rem"},children:n.jsx(Z,{onClick:oe,disabled:L||!x,className:"config-dialog__button config-dialog__button--primary",children:L?"Setting...":"Set Schema Values"})})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(g,{className:"config-dialog__label",children:"VAD Config"}),n.jsxs("div",{className:"config-dialog__vad-config",children:[n.jsx("div",{className:"config-dialog__vad-toggle",children:n.jsxs("label",{className:"config-dialog__checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:typeof e[e.environment].stt.vad=="object",onChange:a=>{const t=e.environment;d({...e,[t]:{...e[t],stt:{...e[t].stt,vad:a.target.checked?{threshold:.5,min_speech_ms:250,min_silence_ms:500,max_segment_ms:3e4}:"default"}}})},className:"config-dialog__checkbox"}),n.jsx("span",{children:"Use custom VAD configuration"})]})}),typeof e[e.environment].stt.vad=="object"&&n.jsxs("div",{className:"config-dialog__vad-fields",children:[n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(g,{htmlFor:"vad-threshold",className:"config-dialog__vad-label",children:"Threshold (0.0 - 1.0)"}),n.jsx(h,{id:"vad-threshold",type:"number",min:"0",max:"1",step:"0.1",value:e[e.environment].stt.vad.threshold||.5,onChange:a=>{const t=e.environment,o=e[t].stt.vad;d({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...o,threshold:parseFloat(a.target.value)||.5}}}})},className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(g,{htmlFor:"vad-min-speech",className:"config-dialog__vad-label",children:"Min Speech (ms)"}),n.jsx(h,{id:"vad-min-speech",type:"number",min:"0",value:e[e.environment].stt.vad.min_speech_ms||250,onChange:a=>{const t=e.environment,o=e[t].stt.vad;d({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...o,min_speech_ms:parseInt(a.target.value)||250}}}})},className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(g,{htmlFor:"vad-min-silence",className:"config-dialog__vad-label",children:"Min Silence (ms)"}),n.jsx(h,{id:"vad-min-silence",type:"number",min:"0",value:e[e.environment].stt.vad.min_silence_ms||500,onChange:a=>{const t=e.environment,o=e[t].stt.vad;d({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...o,min_silence_ms:parseInt(a.target.value)||500}}}})},className:"config-dialog__input"})]}),n.jsxs("div",{className:"config-dialog__vad-field",children:[n.jsx(g,{htmlFor:"vad-max-segment",className:"config-dialog__vad-label",children:"Max Segment (ms)"}),n.jsx(h,{id:"vad-max-segment",type:"number",min:"0",value:e[e.environment].stt.vad.max_segment_ms||3e4,onChange:a=>{const t=e.environment,o=e[t].stt.vad;d({...e,[t]:{...e[t],stt:{...e[t].stt,vad:{...o,max_segment_ms:parseInt(a.target.value)||3e4}}}})},className:"config-dialog__input"})]})]})]})]})]}),n.jsxs("section",{className:"config-dialog__section",children:[n.jsxs("div",{className:"config-dialog__section-header",children:[n.jsx("h3",{className:"config-dialog__section-title",children:"Text-to-Speech"}),n.jsx("p",{className:"config-dialog__section-subtitle",children:"Configure voice synthesis settings and voice selection"})]}),n.jsxs("div",{className:"config-dialog__field-group",children:[n.jsx(g,{htmlFor:"tts-voice",className:"config-dialog__label",children:"Voice"}),n.jsxs(q,{value:e[e.environment].tts.voice,onValueChange:a=>{var o;console.log("[ConfigDialog] TTS voice changed:",{from:e[e.environment].tts.voice,to:a,voiceLabel:(o=Y.find(s=>s.value===a))==null?void 0:o.label});const t=e.environment;d({...e,[t]:{...e[t],tts:{...e[t].tts,voice:a}}})},children:[n.jsx(G,{className:"config-dialog__select",children:n.jsx(z,{placeholder:"Select voice"})}),n.jsx(M,{children:Y.map(a=>n.jsx(W,{value:a.value,children:a.label},a.value))})]})]}),n.jsx("div",{className:"config-dialog__info-box",children:n.jsx("p",{className:"config-dialog__info-text",children:"Language/Accent: Fixed to English (en) - non-editable"})})]})]}),n.jsx("div",{className:"config-dialog__footer",children:n.jsxs("div",{className:"config-dialog__button-container",children:[n.jsx("div",{className:"config_buttons",children:n.jsx(Z,{onClick:te,disabled:A,className:"config-dialog__button config-dialog__button--primary",children:A?"Connecting...":R&&x?"Reload":"Connect"})}),n.jsx("div",{className:"config-dialog__info-box",children:n.jsx("p",{className:"config-dialog__info-text",children:"All configuration settings are automatically cached and will be remembered for future sessions"})})]})})]})}):null}export{be as ConfigDialog};
