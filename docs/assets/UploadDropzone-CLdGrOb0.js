import{j as c}from"./ui-c6rpaoQp.js";import{r as a}from"./vendor-B6OAZll8.js";import{b as _}from"./state-BMzes8HB.js";import{h as T,s as M,c as U,B}from"./index-Dq3Wn9vs.js";import{u as C}from"./useSTT-DgwqpvDM.js";import{t as f}from"./utils-E4Pq5uL6.js";import{k as N}from"./icons-Dzbm43Jr.js";import"./useConnection-rGivOEL_.js";import"./sdk-_0emOJGD.js";function P(o){const s=o.environment;return{apiKey:o[s].connection.apiKey,baseUrl:o[s].connection.baseUrl,authBaseUrl:o[s].connection.authBaseUrl,workflowId:o[s].connection.workflowId,environment:s,stt:o[s].stt,tts:o[s].tts}}function J({onUploadComplete:o}){const[,s]=_(T),[x]=_(M),y=P(x),[w,g]=a.useState(!1),[S,u]=a.useState(!1),h=a.useRef(null),{transcribeFile:k}=C(),p=[".wav",".mp3",".mp4"],D=50*1024*1024,z=e=>{var n;const t="."+((n=e.name.split(".").pop())==null?void 0:n.toLowerCase());return p.includes(t)?e.size>D?`File too large. Maximum size: ${Math.round(D/1024/1024)}MB`:null:`File type not supported. Please upload: ${p.join(", ")}`},v=e=>{const t=z(e);if(t){f.error(t);return}b(e)},b=async e=>{if(!y.apiKey){f.error("Please configure your API key first");return}g(!0);const t=`upload_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,n={id:`user_${Date.now()}`,role:"user",content:`ðŸ“ ${e.name} (${Math.round(e.size/1024)}KB)`,createdAt:Date.now(),kind:"STT File",status:"processing",fileName:e.name,fileType:e.type,conversation_session_id:t};s(r=>({...r,messages:[...r.messages,n]}));try{const i=(await k(e)).text;s(l=>({...l,messages:l.messages.map(m=>m.id===n.id?{...m,status:"done"}:m)}));const d={id:`assistant_${Date.now()}`,role:"assistant",content:i,createdAt:Date.now(),kind:"Transcription",status:"done",conversation_session_id:t};s(l=>({...l,messages:[...l.messages,d]})),o==null||o(i)}catch(r){console.error("Upload Error:",r),f.error("File upload failed"),s(i=>({...i,messages:i.messages.filter(d=>d.id!==n.id)}))}finally{g(!1)}},F=e=>{var n;const t=(n=e.target.files)==null?void 0:n[0];t&&v(t)},$=a.useCallback(e=>{e.preventDefault(),e.stopPropagation(),u(!0)},[]),I=a.useCallback(e=>{e.preventDefault(),e.stopPropagation(),u(!1)},[]),j=a.useCallback(e=>{e.preventDefault(),e.stopPropagation(),u(!1);const t=e.dataTransfer.files;if(t.length>0){const n=t[0];v(n)}},[]);return c.jsxs("div",{className:`${U("UploadDropzone","upload-dropzone")} ${S?"drag-over":""}`,onDragOver:$,onDragLeave:I,onDrop:j,children:[c.jsx("input",{ref:h,type:"file",accept:p.join(","),onChange:F,className:"upload-dropzone__file-input"}),c.jsx(B,{variant:"outline",size:"sm",onClick:()=>{var e;return(e=h.current)==null?void 0:e.click()},disabled:w,className:"upload-dropzone__upload-button",children:c.jsx(N,{className:"upload-dropzone__upload-icon"})})]})}export{J as UploadDropzone};
