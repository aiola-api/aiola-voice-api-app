import{j as s}from"./ui-DXEsCjYO.js";import{r as p}from"./vendor-B6OAZll8.js";import{b as y}from"./state-BMzes8HB.js";import{d as D,s as T,c as B,B as _}from"./index-urjlV3O_.js";import{u as C}from"./useSTT-Cz6c9byl.js";import{t as g}from"./utils-E4Pq5uL6.js";import{i as P,j as K,k as R,l as A}from"./icons-0o0JEzD5.js";import"./useConnection-BggP5CuE.js";import"./sdk-9Bd1H_oq.js";function E(n){const t=n.environment;return{apiKey:n[t].connection.apiKey,baseUrl:n[t].connection.baseUrl,authBaseUrl:n[t].connection.authBaseUrl,workflowId:n[t].connection.workflowId,environment:t,stt:n[t].stt,tts:n[t].tts}}function W({onUploadComplete:n}){const[,t]=y(D),[b]=y(T),I=E(b),[j,w]=p.useState(!1),[x,l]=p.useState(0),[N,c]=p.useState(null),d=p.useRef(null),{transcribeFile:k}=C(),f=[".wav",".mp3",".mp4"],v=50*1024*1024,F=e=>{var r;const a="."+((r=e.name.split(".").pop())==null?void 0:r.toLowerCase());return f.includes(a)?e.size>v?`File too large. Maximum size: ${Math.round(v/1024/1024)}MB`:null:`File type not supported. Please upload: ${f.join(", ")}`},S=e=>{const a=F(e);if(a){g.error(a);return}c(e),z(e)},z=async e=>{if(!I.apiKey){g.error("Please configure your API key first");return}w(!0),l(0);const a=`upload_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,r={id:`user_${Date.now()}`,role:"user",content:`ðŸ“ ${e.name} (${Math.round(e.size/1024)}KB)`,createdAt:Date.now(),kind:"STT File",status:"processing",fileName:e.name,fileType:e.type,conversation_session_id:a};t(i=>({...i,messages:[...i.messages,r]}));try{const i=setInterval(()=>{l(o=>o>=90?(clearInterval(i),o):o+Math.random()*10)},200),u=await k(e);clearInterval(i),l(100);const m=u.text;t(o=>({...o,messages:o.messages.map(h=>h.id===r.id?{...h,status:"done"}:h)}));const U={id:`assistant_${Date.now()}`,role:"assistant",content:m,createdAt:Date.now(),kind:"Transcription",status:"done",conversation_session_id:a};t(o=>({...o,messages:[...o.messages,U]})),c(null),n==null||n(m)}catch(i){console.error("Upload Error:",i),g.error("File upload failed"),t(u=>({...u,messages:u.messages.filter(m=>m.id!==r.id)})),c(null)}finally{w(!1),l(0)}},M=e=>{var r;const a=(r=e.target.files)==null?void 0:r[0];a&&S(a)},$=()=>{c(null),d.current&&(d.current.value="")};return s.jsxs("div",{className:B("UploadDropzone","upload-dropzone"),children:[s.jsx("input",{ref:d,type:"file",accept:f.join(","),onChange:M,className:"upload-dropzone__file-input"}),s.jsx(_,{variant:"outline",size:"sm",onClick:()=>{var e;return(e=d.current)==null?void 0:e.click()},disabled:!0,className:"upload-dropzone__upload-button",children:s.jsx(P,{className:"upload-dropzone__upload-icon"})}),N&&s.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 dark:bg-slate-700/50 rounded-xl px-4 py-3 min-w-0 border border-slate-200 dark:border-slate-600",children:[s.jsx(K,{className:"h-4 w-4 flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"text-sm font-medium truncate",children:N.name}),j&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"flex-1 bg-background rounded-full h-1.5",children:s.jsx("div",{className:"bg-primary h-1.5 rounded-full transition-all duration-300",style:{width:`${x}%`}})}),s.jsxs("span",{className:"text-xs text-muted-foreground",children:[Math.round(x),"%"]})]}),!j&&x===100&&s.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[s.jsx(R,{className:"h-3 w-3"}),s.jsx("span",{className:"text-xs",children:"Complete"})]})]}),s.jsx(_,{variant:"ghost",size:"sm",onClick:$,className:"h-6 w-6 p-0",children:s.jsx(A,{className:"h-3 w-3"})})]})]})}export{W as UploadDropzone};
