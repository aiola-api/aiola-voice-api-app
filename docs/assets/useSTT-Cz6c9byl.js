import{c as h}from"./state-BMzes8HB.js";import{u as F}from"./useConnection-BggP5CuE.js";import{s as v}from"./index-urjlV3O_.js";import{r as i}from"./vendor-B6OAZll8.js";function d(e){const r=e.environment;return{apiKey:e[r].connection.apiKey,baseUrl:e[r].connection.baseUrl,authBaseUrl:e[r].connection.authBaseUrl,workflowId:e[r].connection.workflowId,environment:r,stt:e[r].stt,tts:e[r].tts}}let n=null;function U(){const e=h(v),{getClient:r,isConnected:f,sessionId:m,updateConnectionState:o,isStreaming:k,error:S,createSession:y}=F(),C=i.useCallback(async()=>{try{const a=await r(),t=d(e),c={};t.stt.keywords.forEach(g=>{c[g]=g});const s={language:t.stt.language,keywords:t.stt.keywords,workflowId:t.workflowId},b=!n||n.settings.language!==s.language||JSON.stringify(n.settings.keywords)!==JSON.stringify(s.keywords)||(n.settings.workflowId||n.settings.flowid||"")!==(s.workflowId||"");if(console.log("useSTT streamCache",n),!b&&n)return o({currentFlowId:t.stt.flowid,error:void 0}),n.connection;const u={langCode:s.language,keywords:c};s.workflowId&&(u.workflowId=s.workflowId);const w=await a.stt.stream(u);return n={connection:w,settings:s},o({currentFlowId:t.workflowId,isStreaming:!0,error:void 0}),w}catch(a){const t=a instanceof Error?a.message:"Failed to create stream";throw o({error:t,isStreaming:!1}),a}},[r,e,o]),p=i.useCallback(async a=>{try{const t=await r(),c=d(e);return{text:(await t.stt.transcribeFile({file:a,language:c.stt.language})).transcript}}catch(t){const c=t instanceof Error?t.message:"Failed to transcribe file";throw o({error:c}),t}},[r,e,o]),l=i.useCallback(()=>{o({isStreaming:!1})},[o]),I=i.useCallback(async()=>{l(),n=null},[l]);return{isConnected:f,isStreaming:k,error:S,sessionId:m,createStreamConnection:C,transcribeFile:p,closeStream:l,testConnection:y,cleanup:I}}export{U as u};
