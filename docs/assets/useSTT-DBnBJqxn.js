import{c as b}from"./state-BMzes8HB.js";import{u as h}from"./useConnection-XzYsOZzo.js";import{s as F}from"./index-DbGP0vH-.js";import{r as c}from"./vendor-B6OAZll8.js";function w(e){const r=e.environment;return{apiKey:e[r].connection.apiKey,baseUrl:e[r].connection.baseUrl,authBaseUrl:e[r].connection.authBaseUrl,workflowId:e[r].connection.workflowId,environment:r,stt:e[r].stt,tts:e[r].tts}}let o=null;function N(){const e=b(F),{getClient:r,isConnected:f,sessionId:m,updateConnectionState:s,isStreaming:k,error:S,createSession:y}=h(),C=c.useCallback(async()=>{try{const a=await r(),t=w(e),i={};t.stt.keywords.forEach(u=>{i[u]=u});const n={language:t.stt.language,keywords:t.stt.keywords,workflowId:t.workflowId,vad:t.stt.vad},I=!o||o.settings.language!==n.language||JSON.stringify(o.settings.keywords)!==JSON.stringify(n.keywords)||(o.settings.workflowId||o.settings.flowid||"")!==(n.workflowId||"")||JSON.stringify(o.settings.vad)!==JSON.stringify(n.vad);if(console.log("useSTT streamCache",o),!I&&o)return s({currentFlowId:t.stt.flowid,error:void 0}),o.connection;const d={langCode:n.language,keywords:i};n.workflowId&&(d.workflowId=n.workflowId),n.vad&&n.vad!=="default"&&(d.vadConfig=n.vad);const g=await a.stt.stream(d);return o={connection:g,settings:n},s({currentFlowId:t.workflowId,isStreaming:!0,error:void 0}),g}catch(a){const t=a instanceof Error?a.message:"Failed to create stream";throw s({error:t,isStreaming:!1}),a}},[r,e,s]),p=c.useCallback(async a=>{try{const t=await r(),i=w(e);return{text:(await t.stt.transcribeFile({file:a,language:i.stt.language})).transcript}}catch(t){const i=t instanceof Error?t.message:"Failed to transcribe file";throw s({error:i}),t}},[r,e,s]),l=c.useCallback(()=>{s({isStreaming:!1})},[s]),v=c.useCallback(async()=>{l(),o=null},[l]);return{isConnected:f,isStreaming:k,error:S,sessionId:m,createStreamConnection:C,transcribeFile:p,closeStream:l,testConnection:y,cleanup:v}}export{N as u};
