import{c as I}from"./state-BMzes8HB.js";import{u as b}from"./useConnection-rGivOEL_.js";import{s as O}from"./index-Dq3Wn9vs.js";import{r as c}from"./vendor-B6OAZll8.js";function w(r){const n=r.environment;return{apiKey:r[n].connection.apiKey,baseUrl:r[n].connection.baseUrl,authBaseUrl:r[n].connection.authBaseUrl,workflowId:r[n].connection.workflowId,environment:n,stt:r[n].stt,tts:r[n].tts}}let s=null;function x(){const r=I(O),{getClient:n,isConnected:f,sessionId:m,updateConnectionState:o,isStreaming:S,error:k,createSession:y}=b(),C=c.useCallback(async()=>{try{const a=await n(),t=w(r),i={};t.stt.keywords.forEach(d=>{i[d]=d});const e={language:t.stt.language,keywords:t.stt.keywords,workflowId:t.workflowId,vad:t.stt.vad,schemaValues:t.stt.schemaValues},v=!s||s.settings.language!==e.language||JSON.stringify(s.settings.keywords)!==JSON.stringify(e.keywords)||(s.settings.workflowId||s.settings.flowid||"")!==(e.workflowId||"")||JSON.stringify(s.settings.vad)!==JSON.stringify(e.vad)||JSON.stringify(s.settings.schemaValues)!==JSON.stringify(e.schemaValues);if(console.log("useSTT streamCache",s),!v&&s)return o({currentFlowId:t.stt.flowid,error:void 0}),s.connection;const g={langCode:e.language,keywords:i};e.workflowId&&(g.workflowId=e.workflowId),e.vad&&e.vad!=="default"&&(g.vadConfig=e.vad);const u=await a.stt.stream(g);return s={connection:u,settings:e},o({currentFlowId:t.workflowId,isStreaming:!0,error:void 0}),u}catch(a){const t=a instanceof Error?a.message:"Failed to create stream";throw o({error:t,isStreaming:!1}),a}},[n,r,o]),h=c.useCallback(async a=>{try{const t=await n(),i=w(r);return{text:(await t.stt.transcribeFile({file:a,language:i.stt.language})).transcript}}catch(t){const i=t instanceof Error?t.message:"Failed to transcribe file";throw o({error:i}),t}},[n,r,o]),l=c.useCallback(()=>{o({isStreaming:!1})},[o]),p=c.useCallback(async()=>{l(),s=null},[l]);return{isConnected:f,isStreaming:S,error:k,sessionId:m,createStreamConnection:C,transcribeFile:h,closeStream:l,testConnection:y,cleanup:p}}export{x as u};
