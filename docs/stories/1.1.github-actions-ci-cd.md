# Story 1.1: GitHub Actions CI/CD for GitHub Pages

## Status
Review

## Story
**As a** release engineer stewarding the aiOla Voice API App,  
**I want** automated CI checks plus an opinionated release pipeline that deploys to the repository’s GitHub Pages site,  
**so that** every change is validated consistently and production builds are continuously published without manual steps.

## Acceptance Criteria
1. PRs and pushes run lint, unit tests, and production build using Node 20 on GitHub Actions.
2. Merges to `main` bump the npm version based on commit intent, tag the release, attach the production build artifact, and publish GitHub release notes.
3. Successful release runs deploy the freshly built `docs/` directory to the repository’s GitHub Pages environment (`https://<owner>.github.io/aiola-voice-api-app/`).
4. Running the release workflow with `act` executes validation steps but skips git pushes, GitHub release creation, and actual Pages deployment (per `.github/LOCAL_TESTING.md` guidance).

## Tasks / Subtasks
- [x] Author CI workflow enforcing lint → test → build gates on pushes/PRs.
  - [x] Configure Node 20 with npm caching and deterministic installs via `npm ci`.
  - [x] Fail fast on lint/test/build errors to block merges that would break the release path.
- [x] Build release workflow that bumps versions, runs quality gates, archives artifacts, and creates GitHub Releases.
  - [x] Auto-detect semantic bump (`major`/`minor`/`patch`) from commit messages with manual overrides for `workflow_dispatch`.
  - [x] Commit/tag/push version changes only on GitHub (never inside local `act` rehearsal runs).
  - [x] Zip the production build and attach it to the Release for distribution.
- [x] Deploy to GitHub Pages through the official `actions/deploy-pages` flow after uploading the built `docs/` artifact.
  - [x] Ensure workflow outputs gate deployments when running under `act` so local tests do not attempt to publish.
- [x] Record the story in `docs/stories` so future BMad agents can trace CI/CD scope and completion evidence.

## Dev Notes
### Context
- The project already documents its release expectations in `.github/RELEASE.md` and local rehearsal flow in `.github/LOCAL_TESTING.md`. Both call for CI validation, semantic version bumps, GitHub Releases, and GitHub Pages deployment, but the workflows were missing.
- `vite.config.ts` outputs production assets to `docs/` with `base` set to `/aiola-voice-api-app/`, so the deployment artifacts are ready for project-scoped GitHub Pages hosting without rewrites.
- The `.bmad-core/core-config.yaml` defines `devStoryLocation: docs/stories`; this story instantiates that location for the CI/CD epic so future Scrum Master cycles have a canonical artifact.

### Testing
- `npm run lint` – currently fails because of pre-existing lint issues (unused variables and `any` types in chat/voice hooks such as `src/components/chat/TTSPlaybackButton.tsx` and `src/hooks/useSTT.ts`).
- `CI=1 npm run test` – passes (Vitest suite runs once under CI semantics).
- `npm run build` – fails due to `src/hooks/useTTS.ts(46,11)` TypeScript error (`voice` is not part of the current `TtsRequest` type). The release workflow will surface the same compile failure until that file is corrected.

## Change Log
| Date       | Version | Description                                  | Author        |
| ---------- | ------- | -------------------------------------------- | ------------- |
| 2025-02-20 | 1.0     | Drafted CI/CD story and implemented solution | Codex (Dev)   |

## Dev Agent Record
### Agent Model Used
OpenAI GPT-5 Codex (2025-02-20)

### Debug Log References
- CLI session only; no standalone `.ai/debug-log.md` entry was required for this workflow automation.

### Completion Notes List
- Added CI workflow covering lint/test/build with cached Node 20 installs.
- Added release workflow that bumps versions, archives builds, creates GitHub Releases, and conditionally deploys.
- Ensured release workflow respects `act` rehearsals and feeds GitHub Pages deployment artifacts.

### File List
- `.github/workflows/ci.yml`
- `.github/workflows/release.yml`
- `docs/stories/1.1.github-actions-ci-cd.md`

## QA Results
- Pending QA review of automated pipeline behavior once executed in GitHub.
